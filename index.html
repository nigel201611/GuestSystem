<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link href="css/froala_editor.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/froala_page.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/common.css" />
    <title>多用户留言系统-首页</title>

</head>
<style>
    .confirmPwd{
        display: none;
    }
    .newMembership .username{
        font-size: 24px;
        white-space: normal;
        word-wrap: break-word;
        word-break: break-all;
    }
    .tipList{
        padding: 40px 0 0 20px;
    }
    .commentCount,
    .readCount,
    .time{
        color: #dddddd;
    }
    .tipList .title{
        font-size: 14px;
        font-weight:bolder;
    }
    .tipList li{
        cursor: pointer;
    }
    #search{
        cursor: pointer;
    }
    .newMembership{
        padding: 40px 0 0 0;
    }
</style>

<body>

    <div class="headerWrap"></div>

    <div class="container">
        <div class="row">
            <div class="col-md-3 col-sm-6">
                <div class="newMembership">
                    <!--#include file="template/newMember2.html" -->
                </div>
                <div class="newImgList"></div>
            </div>
            <div class="col-md-8 col-sm-6">
                <div class="issuePost">

                    <button class="btn btn-default issueTz pull-right">
                        <span class="glyphicon glyphicon-share-alt"></span>
                        发布帖子
                    </button>
                </div>
                <div class="tipList">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="请输入标题" >
                        <span class="input-group-addon" id="search">
                            <span class="glyphicon glyphicon-search"></span>
                        </span>
                    </div>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>

                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>

                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>

                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="title">标题-我的是开始思考思考思考开始快速打开</a>
                            <span class="pull-right">
                                <span class="readCount">阅读次数(100)</span>
                                <span class="commentCount">评论次数(100)</span>
                                <span class="time"> 2017-7-20</span>
                            </span>
                        </li>
                    </ul>
                    <!--分页list-->
                    <div class="pagelist text-center">
                        <nav aria-label="Page navigation" class="Page">

                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footerWrap"></div>

    <!--#include file="template/modalTemplate.html"-->

    <!--发布帖子模态框-->
    <div class="modal fade" tabindex="-1" role="dialog" id="issueTzModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">发布帖子</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="issuePostForm" >
                        <div class="form-group">
                            <label class="col-sm-2 control-label">帖子标题</label>
                            <div class="col-sm-6">
                                <input type="text" name="article_title" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6 errcheck tzTitleErr" >
                                帖子标题不能为空
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">帖子内容</label>
                            <div class="col-sm-10">
                                <div id="edit"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">验证码</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="yzcode">
                            </div>
                            <div class="col-sm-2">
                                <img class="yzcodeImg" src="data/yzCode.php" alt="单击刷新验证码" title="单击刷新验证码">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6 errcheck yzcodeErr" >
                                验证码不正确
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6">
                                <button type="submit" class="btn btn-default">发布</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!--发送信息模态框-->
    <div class="modal fade" tabindex="-1" role="dialog" id="sendMessageModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">发送消息</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="sendMessageForm" >
                        <div class="form-group">
                            <label class="col-sm-2 control-label">接收人</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="to_user" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">消息内容</label>
                            <div class="col-sm-6">
                                <textarea type="text" class="form-control" name="content" autocomplete="off"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6 errcheck contentEmptyErr" >
                                消息内容不能为空
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">验证码</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="yzcode">
                            </div>
                            <div class="col-sm-2">
                                <img class="yzcodeImg" src="data/yzCode.php" alt="单击刷新验证码" title="单击刷新验证码">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6 errcheck yzcodeErr" >
                                验证码不正确
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6">
                                <button type="submit" class="btn btn-default">提交</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!--加好友模态框-->
    <div class="modal fade" tabindex="-1" role="dialog" id="addFriendModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">加好友</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="addFriendForm" >
                        <div class="form-group">
                            <label class="col-sm-2 control-label">昵称</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="to_user" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">加好友信息</label>
                            <div class="col-sm-6">
                                <textarea type="text" class="form-control" name="content" autocomplete="off">您好，期待认识您!</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6 errcheck contentEmptyErr" >
                                消息内容不能为空
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">验证码</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="yzcode">
                            </div>
                            <div class="col-sm-2">
                                <img class="yzcodeImg" src="data/yzCode.php" alt="单击刷新验证码" title="单击刷新验证码">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6 errcheck yzcodeErr" >
                                验证码不正确
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6">
                                <button type="submit" class="btn btn-default">提交</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!--送花模态框-->
    <div class="modal fade" tabindex="-1" role="dialog" id="sendFlowerModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">送花</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="sendFlowerForm" >
                        <div class="form-group">
                            <label class="col-sm-2 control-label">接收者</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="to_user" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">花朵数量</label>
                            <div class="col-sm-6">
                                <input type="text" name="flowerCount" class="form-control">
                                <ul id="flowerMenu">
                                    <li data-value="1">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                    <li data-value="2">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                    <li data-value="3">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                    <li data-value="4">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                    <li data-value="5">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                    <li data-value="6">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                    <li data-value="7">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                    <li data-value="8">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                    <li data-value="9">
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                        <span class="glyphicon glyphicon-apple flower"></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">送花信息</label>
                            <div class="col-sm-6">
                                <textarea type="text" class="form-control" name="content" autocomplete="off"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">验证码</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="yzcode">
                            </div>
                            <div class="col-sm-2">
                                <img class="yzcodeImg" src="data/yzCode.php" alt="单击刷新验证码" title="单击刷新验证码">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6 errcheck yzcodeErr" >
                                验证码不正确
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6">
                                <button type="submit" class="btn btn-default">送花</button>
                            </div>
                        </div>
                        <div id="flowerMenuMask"></div>
                    </form>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

</body>

<script src="js/jquery-1.11.3.js"></script>
<script src="js/froala_editor/froala_editor.min.js"></script>
<!--[if lt IE 9]>
<script src="../js/froala_editor/froala_editor_ie8.min.js"></script>
<![endif]-->
<script src="js/froala_editor/plugins/tables.min.js"></script>
<script src="js/froala_editor/plugins/lists.min.js"></script>
<script src="js/froala_editor/plugins/colors.min.js"></script>
<script src="js/froala_editor/plugins/media_manager.min.js"></script>
<script src="js/froala_editor/plugins/font_family.min.js"></script>
<script src="js/froala_editor/plugins/font_size.min.js"></script>
<script src="js/froala_editor/plugins/block_styles.min.js"></script>

<script src="js/bootstrap.min.js"></script>
<script src="js/noty.min.js"></script>
<script src="js/template.js"></script>
<script src="js/common.js"></script>
<script src="js/login_register.js"></script>

<script type="text/html" id="tzTemp">
    <%for(var i = 0; i < info.length; i++) {%>
    <li class="list-group-item">
        <a href="showTzContent.html?id=<%:=info[i].id%>" class="title" data-title="<%:=info[i].pub_title%>" data-id="<%:=info[i].id%>"><%:=info[i].pub_title%></a>
        <span class="pull-right">
            <span class="readCount">阅读次数(<%:=info[i].pub_readCount%>)</span>
            <span class="commentCount">评论次数(<%:=info[i].pub_commentCount%>)</span>
            <span class="time"> <%:=info[i].pub_date%></span>
        </span>
    </li>
    <%}%>
</script>

<script src="js/addFriend_flower_message.js"></script>
<script src="js/myPage.js"></script>

<script>
    (function () {
        var username;
        $('.headerWrap').load('common.inc/header.html',function () {
            var userInfo;
            if(window.localStorage.getItem('userInfo')){
                userInfo = JSON.parse(window.localStorage.getItem('userInfo'));
            }
            if(userInfo && userInfo.username){
                username = userInfo.username;
                $('.headerWrap').find('.username').text(userInfo.username);
                $('.headerWrap').find('.login').hide();
                $('.headerWrap').find('.register').hide();
                $('.headerWrap').find(".loginOut").removeClass('hidden');

                //请求信息接口，获取未查看信息条数
                $.get("data/getMessageCount.php?username="+userInfo.username,function (count) {
                    if(count>0){
                        $(".envelope_count").text(count).css({display:"inline-block"});
                    }
                });

                //消息增加点击事件，跳转到信息查看页面
                $('.envelope_wrap').click(function () {
                    var menuList = [0,0,1,0,0,0];
                    localStorage.setItem("menuList",JSON.stringify(menuList));
                    location.href = 'person_center.html';
                });

            }
        });
        $('.footerWrap').load('common.inc/footer.html');
        function notyInfo(data){
            noty({
                text: data,
                layout: "center",
                type: "warning",
                modal: true,
                buttons: [
                    {
                        addClass: 'btn btn-primary btn-xs',
                        text: '关闭',
                        onClick: function ($noty) {
                            $noty.close();
                        }
                    }
                ]
            });
        }
        function validateLogin2() {
            var userInfo;
            if(window.localStorage.getItem('userInfo')){
                userInfo = JSON.parse(window.localStorage.getItem('userInfo'));
            }
            if( userInfo && userInfo.username){
                $('.headerWrap').find('.username').text(userInfo.username);
                $('.headerWrap').find('.login').hide();
                $('.headerWrap').find('.register').hide();
                $('.headerWrap').find(".loginOut").removeClass('hidden');

                //请求信息接口，获取未查看信息条数
                $.get("data/getMessageCount.php?username="+userInfo.username,function (count) {
                    if(count>0){
                        $(".envelope_count").text(count).css({display:"inline-block"});
                    }
                });

                return true;

            }else{
                $("#loginModal").modal('show');
                return false;
            }
        }

//帖子编辑器初始化
        var $issuePostForm = $("#issuePostForm"),
            $issueTzModal = $("#issueTzModal");
        $('#edit').editable({inlineMode: false, alwaysBlank: true});
        //隐藏模态框时，清空帖子模态框内容
        $issueTzModal.on('hide.bs.modal',function () {
            $issueTzModal.find("input[name=article_title]").val("");
            $issueTzModal.find(".froala-element.f-basic").html("");

            $issueTzModal.find(".yzcodeImg").attr('src',"data/yzCode.php");
        });
        $(".issueTz").click(function () {
            //发布帖子前验证登陆有效性
           var loginFlag =  validateLogin2();
           if(loginFlag){
               $issueTzModal.modal('show');
           }
        });
        //处理图片在某些浏览器偶然性概率打开慢的问题
        $issueTzModal.on('click','button[data-cmd=insertImage]',function () {
            $('.froala-image-popup').find('input[type=file]').attr("accept",
                "image/jpg,image/jpeg,image/png,image/tif,image/gif,image/bmp,image/jpeg");
        });
        $issuePostForm.on('blur keyup','input[name=yzcode]',function () {
            var yzcode = $(this).val();
            //验证用户输入的验证码是否和服务器端生成的一样
            if(yzcode != getCookie('yzcode')){
                $(".yzcodeErr").show();
                //提交禁用
                $issuePostForm.find("button[type=submit]").attr('disabled',true);
                return;
            }else{
                $(".yzcodeErr").hide();
                $issuePostForm.find("button[type=submit]").attr('disabled',false);
            }
        });
        $issuePostForm.find("input[name=yzcode]").focus(function () {
            $(".yzcodeErr").hide();
        });
        $issuePostForm.find(".yzcodeImg").click(function () {
            this.src= "data/yzCode.php";
        });
        //发布帖子
        $issuePostForm.submit(function (e) {
            e.preventDefault();
            var data = $(this).serializeArray();
            var tzTitle = data[0].value,
                yzcode = data[1].value;
            //验证码验证
            if(yzcode != getCookie('yzcode') || yzcode==''){
                $(".yzcodeErr").show();
                //提交禁用
                $issuePostForm.find("button[type=submit]").attr('disabled',true);
                return;
            }else{
                $(".yzcodeErr").hide();
                //提交禁用
                $issuePostForm.find("button[type=submit]").attr('disabled',false);
            }
            //帖子标题不能为空
            if(tzTitle==''){
                $(".tzTitleErr").show();
                //提交禁用
                $issuePostForm.find("button[type=submit]").attr('disabled',true);
                return;
            }else{
                $(".tzTitleErr").hide();
                //提交禁用
                $issuePostForm.find("button[type=submit]").attr('disabled',false);
            }
            var tzContent = $('.froala-element.f-basic').html();
            var data = {
                tzTitle:tzTitle,
                tzContent:tzContent
            };

            //请求接口，发布
          $.ajax({
              type:'POST',
              url:'data/issuePost.php',
              dataType:'JSON',
              data:data,
              success:function (rsp) {
                  if(rsp.code==0){
                      notyInfo("发布成功");
                      $issueTzModal.modal('hide');
                  }else if(rsp.code==2){
                      //重新登录
                      $("#loginModal").modal('show');
                  }else if(rsp.code==-1){
                      notyInfo("发布失败");
                  }
              }
          });
        });
        //显示帖子
        //分页加载博客列表
        function showTz(curPage) {
            $.ajax({
                type:"GET",
                url:"data/showTz.php?page="+curPage,
                dataType:"JSON",
                async:false,
                success:function (rsp) {
                    if(rsp.code==0){
                        var totalPages = rsp.pagesCount;
                        //显示消息数据
                        var info = rsp.info;
//                        for(var i=0;i<data.length;i++){
//                            var imgSrc = "";
//                            var index = Math.floor(Math.random()*6+1);
//                            if(data[i].head_img){
//                                imgSrc = "img/headPhoto/"+data[i].head_img;
//                            }else{//如果头像不存在，就使用系统随机生成的头像
//                                imgSrc = "img/headPhoto/"+index+".jpg";
//                            }
//                            data[i].head_img = imgSrc;
//                        }
                        var dataHtml = document.getElementById("tzTemp").innerHTML;
                        var html = template(dataHtml,{info:info});
                        $(".tipList>ul").html(html);
                        //生成分页list
                        $(".pagelist .Page").html(pages(totalPages,curPage));
                    }else if(rsp.code==2){
                        //重新登录
                        $("#loginModal").modal('show');
                    }else{
                        $(".tipList>ul").html("暂无任何帖子");
                    }
                }
            });
        }
        showTz(1);

        var $tipList = $(".tipList");
        function initAction($wrap){
            var $pagelist = $wrap.find(".pagelist").eq(0);
            $pagelist.on('click','li>a:not(.prev,.next)',function (e) {
                e.preventDefault();
                var curPage = parseInt($(this).attr('data-page'));
                showTz(curPage);
            });
            //上一页，下一页
            $pagelist.on('click','.prev',function (e) {
                e.preventDefault();
                var curPage = parseInt($pagelist.find(".nowPage.active>a").attr("data-page"));
                curPage--;
                if(curPage>0){
                    showTz(curPage);
                }else{
                    showTz(1);
                }
            });
            $pagelist.on('click','.next',function (e) {
                e.preventDefault();
                //获取当前页curPage
                var totalPages = $pagelist.find(".totalPage").attr('data-total');
                var curPage = parseInt($pagelist.find(".nowPage.active>a").attr("data-page"));
                curPage++;
                if(curPage<=totalPages){
                    showTz(curPage);
                }else{
                    //获取中页数
                    showTz(totalPages);
                }
            });
        }
        initAction($tipList);
        //初始化加好友，送花，发送信息等功能
        if(window.localStorage.getItem('userInfo')) {
            var userInfo = JSON.parse(window.localStorage.getItem('userInfo'));
            if( userInfo && userInfo.username){
                username =  userInfo.username;
            }else{
                $("#loginModal").modal('show');
            }
        }
        $.addFFM($(".newMembership"),username);
        //处理froala编辑器，图片上传到本地，而不是上传到第三方服务器

        //增加搜索帖子功能
    })()

</script>


</html>
